stage:
- Build 1
- Build 2
- Approval
- Build 3: @maven

Build 1:
- @maven: mvn clean package -Dmaven.test.skip=true
- @maven:
    - mvn $maven.module_1
    - mvn $maven.module_2

Build 2:
- @maven mavenCmd:
      goal: ${maven.goal}
      options: ${maven.options}
- @docker dockerCmd.build:
      goal: ${maven.goal}
      options: ${maven.options}

Approval:
- input: Deploy to prod?

Build 3:
- maven:
    goal: ${maven.goal}
    options: ${maven.options}
- mvn $maven.module_1
- @maven-2:
  - mvn $maven.module_1



agent:
- name: slave1
  profile: [maven, docker]
  volumes:
  - {pvc/slave-workspace: /root/.m2/repository, readOnly: false}
- name: slave2
  profile: [kubectl]

env:
  maven:
    goal: clean package
    options: -Dmaven.test.skip=true
    module_1: $maven.goal -P module_1 $maven.options
    module_2: $maven.goal -P module_2 $maven.options
